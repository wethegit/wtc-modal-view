"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _wtcUtilityHelpers=_interopRequireDefault(require("wtc-utility-helpers"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var Modal=function(){function Modal(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Modal);var _ref=options||null,closeHtml=_ref.closeHtml,optionalClass=_ref.optionalClass,onOpen=_ref.onOpen,onClose=_ref.onClose;this.state=!1,this.modal=document.createElement("div"),this.modalOverlay=document.createElement("div"),this.modalFocusStart=document.createElement("div"),this.modalFocusEnd=document.createElement("div"),this.modalClose=document.createElement("button"),this.modalClose.innerHTML=closeHtml||"<span>Close</span>",this.modalWrapper=document.createElement("div"),this.modalContent=document.createElement("div"),this.className="modal",this.classNameOpen="modal--open",this.appended=!1,this.onOpen=onOpen,this.onClose=onClose,this.focusOnClose=null,this.modal.classList.add(this.className),optionalClass&&this.modal.classList.add(optionalClass),this.modalOverlay.classList.add("".concat(this.className,"__overlay")),this.modalFocusStart.classList.add("".concat(this.className,"__focus-start")),this.modalFocusEnd.classList.add("".concat(this.className,"__focus-end")),this.modalClose.classList.add("".concat(this.className,"__close")),this.modalWrapper.classList.add("".concat(this.className,"__wrapper")),this.modalContent.classList.add("".concat(this.className,"__content")),this.modal.setAttribute("role","dialog"),this.modalFocusStart.setAttribute("tabindex",-1),this.modalFocusEnd.setAttribute("tabindex",0),this.modalWrapper.appendChild(this.modalFocusStart),this.modalWrapper.appendChild(this.modalClose),this.modalWrapper.appendChild(this.modalContent),this.modalWrapper.appendChild(this.modalFocusEnd),this.modal.appendChild(this.modalOverlay),this.modal.appendChild(this.modalWrapper),this.modalFocusEnd.addEventListener("focus",this.focusFirstElement),this.modalClose.addEventListener("click",this.close.bind(this)),this.modalOverlay.addEventListener("click",this.close.bind(this))}return _createClass(Modal,[{key:"close",value:function(){var _this=this;this.state&&(this.modal.classList.remove(this.classNameOpen),this.focusOnClose&&(this.focusOnClose instanceof HTMLButtonElement||this.focusOnClose.getAttribute("tabindex")||this.focusOnClose instanceof HTMLAnchorElement?(this.focusOnClose.focus(),this.focusOnClose=null):console.error("focusOnClose element must be a focusable alement, or must have a tabindex attribute.")),setTimeout(function(){_this.state=!1},500),Modal.hash&&history.replaceState("",document.title,window.location.pathname),this.onClose&&this.onClose(),_wtcUtilityHelpers.default.fireCustomEvent("wtc-modal-close",{modal:this}))}},{key:"open",value:function(content,focusOnClose){var _this2=this;if(!this.state){document.body.appendChild(this.modal),content&&("string"==typeof content?this.modalContent.innerHTML=content:this.modalContent.appendChild(content),focusOnClose&&focusOnClose instanceof HTMLElement&&(this.focusOnClose=focusOnClose));var delay=this.appended?0:100;this.appended||(this.appended=!0),setTimeout(function(){_this2.modal.classList.add(_this2.classNameOpen)},delay),this.state=!0,this.focusFirstElement(),this.onOpen&&this.onOpen();document.addEventListener("keydown",function onKeyDown(e){27==e.keyCode&&(_this2.close(),document.removeEventListener("keydown",onKeyDown.bind(_this2),!1))}.bind(this),!1),_wtcUtilityHelpers.default.fireCustomEvent("wtc-modal-open",{modal:this})}}},{key:"focusFirstElement",value:function(){this.modalFocusStart.focus()}}],[{key:"hash",get:function(){var URLhash=/#\!?\/(.+)\//i.exec(window.location.hash);return URLhash&&1<URLhash.length?URLhash[1]:null}}]),Modal}(),_default=Modal;exports.default=_default;