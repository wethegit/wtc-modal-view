"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _wtcUtilityHelpers=_interopRequireDefault(require("wtc-utility-helpers"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var instance=null,Modal=function(){function Modal(){return _classCallCheck(this,Modal),instance||(this.state=!1,this.modal=document.createElement("div"),this.modalOverlay=document.createElement("div"),this.modalFocusStart=document.createElement("div"),this.modalFocusEnd=document.createElement("div"),this.modalClose=document.createElement("button"),this.modalClose.innerHTML="<span>Close</span>",this.modalWrapper=document.createElement("div"),this.modalContent=document.createElement("div"),this.className="modal",this.classNameOpen="modal--open",this.optionalClass=null,this.appended=!1,this.onOpen=null,this.onClose=null,this.modal.classList.add(this.className),this.modalOverlay.classList.add("".concat(this.className,"__overlay")),this.modalFocusStart.classList.add("".concat(this.className,"__focus-start")),this.modalFocusEnd.classList.add("".concat(this.className,"__focus-end")),this.modalClose.classList.add("".concat(this.className,"__close")),this.modalWrapper.classList.add("".concat(this.className,"__wrapper")),this.modalContent.classList.add("".concat(this.className,"__content")),this.modal.setAttribute("role","dialog"),this.modalFocusStart.setAttribute("tabindex",-1),this.modalFocusEnd.setAttribute("tabindex",0),this.modalWrapper.appendChild(this.modalFocusStart),this.modalWrapper.appendChild(this.modalClose),this.modalWrapper.appendChild(this.modalContent),this.modalWrapper.appendChild(this.modalFocusEnd),this.modal.appendChild(this.modalOverlay),this.modal.appendChild(this.modalWrapper),document.body.appendChild(this.modal),(instance=this).modalClose.addEventListener("click",function(e){Modal.close()}),this.modalOverlay.addEventListener("click",function(e){Modal.close()}),this)}return _createClass(Modal,null,[{key:"close",value:function(){var modal=Modal.instance;return modal.state&&(modal.modal.classList.remove(modal.classNameOpen),modal.focusOnClose&&(modal.focusOnClose instanceof HTMLButtonElement||modal.focusOnClose.getAttribute("tabindex")||modal.focusOnClose instanceof HTMLAnchorElement?modal.focusOnClose.focus():console.error("focusOnClose element must be a focusable alement, or must have a tabindex attribute.")),setTimeout(function(){modal.optionalClass&&(modal.modal.classList.remove(modal.optionalClass),modal.optionalClass=null),modal.state=!1,modal.modalContent.innerHTML=""},500),modal.modalFocusEnd.removeEventListener("focus",Modal.focusFirstElement),Modal.hash&&history.replaceState("",document.title,window.location.pathname),modal.onClose&&modal.onClose(),_wtcUtilityHelpers.default.fireCustomEvent("wtc-modal-close",{modal:this})),modal}},{key:"open",value:function(content,optionalClass,focusOnClose){var _this=this,modal=Modal.instance;if(!modal.state){content&&("string"==typeof content?modal.modalContent.innerHTML=content:modal.modalContent.appendChild(content),focusOnClose&&focusOnClose instanceof HTMLElement&&(modal.focusOnClose=focusOnClose)),optionalClass&&(modal.modal.classList.add(optionalClass),modal.optionalClass=optionalClass);var delay=modal.appended?0:100;modal.appended||(modal.appended=!0),setTimeout(function(){modal.modal.classList.add(modal.classNameOpen)},delay),modal.state=!0,Modal.focusFirstElement(),modal.onOpen&&modal.onOpen(),this.onKeyDown=function(e){27==e.keyCode&&(Modal.close(),document.removeEventListener("keydown",_this.onKeyDown,!1))},document.addEventListener("keydown",this.onKeyDown,!1),modal.modalFocusEnd.addEventListener("focus",Modal.focusFirstElement),_wtcUtilityHelpers.default.fireCustomEvent("wtc-modal-open",{modal:this})}return modal}},{key:"focusFirstElement",value:function(){Modal.instance.modalFocusStart.focus()}},{key:"hash",get:function(){var URLhash=/#\!?\/(.+)\//i.exec(window.location.hash);return URLhash&&1<URLhash.length?URLhash[1]:null}},{key:"onOpen",set:function(argument_0){var callback=0<arguments.length&&void 0!==argument_0?argument_0:null;if("function"!=typeof callback)throw"Must be a function";return this.instance.onOpen=callback,this.instance}},{key:"onClose",set:function(argument_0){var callback=0<arguments.length&&void 0!==argument_0?argument_0:null;if("function"!=typeof callback)throw"Must be a function";return this.instance.onClose=callback,this.instance}},{key:"modal",get:function(){return this.instance.modal}},{key:"modalContent",get:function(){return this.instance.modalContent}},{key:"instance",get:function(){return instance=instance||new Modal}}]),Modal}(),_default=Modal;exports.default=_default;