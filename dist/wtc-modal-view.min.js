"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Modal=function(){function Modal(){var _this=this;_classCallCheck(this,Modal),this.state=!1,this.modal=document.createElement("div"),this.modalOverlay=document.createElement("div"),this.modalFocusStart=document.createElement("div"),this.modalFocusEnd=document.createElement("div"),this.modalClose=document.createElement("button"),this.modalClose.innerHTML="<span>Close</span>",this.modalWrapper=document.createElement("div"),this.modalContent=document.createElement("div"),this.wrapperOfContent=document.createElement("div"),this.className="modal",this.classNameOpen="modal--open",this.appended=!1,this.storeContent=!1,this._onOpen=null,this._onClose=null,this._focusOnClose=null,this._content=null,this.modal.classList.add(this.className),this.modalOverlay.classList.add("".concat(this.className,"__overlay")),this.modalFocusStart.classList.add("".concat(this.className,"__focus-start")),this.modalFocusEnd.classList.add("".concat(this.className,"__focus-end")),this.modalClose.classList.add("".concat(this.className,"__close")),this.modalWrapper.classList.add("".concat(this.className,"__wrapper")),this.modalContent.classList.add("".concat(this.className,"__content")),this.wrapperOfContent.classList.add("".concat(this.className,"-content-wrapper")),this.modal.setAttribute("role","dialog"),this.modalFocusEnd.setAttribute("tabindex",0),this.modalFocusStart.setAttribute("tabindex",0),this.modalContent.setAttribute("tabindex",-1),this.modalWrapper.appendChild(this.modalFocusStart),this.modalWrapper.appendChild(this.modalClose),this.modalWrapper.appendChild(this.modalContent),this.modalWrapper.appendChild(this.modalFocusEnd),this.modal.appendChild(this.modalOverlay),this.modal.appendChild(this.modalWrapper),document.body.appendChild(this.wrapperOfContent),this.modalFocusEnd.addEventListener("focus",function(){_this.modalClose.focus()}),this.modalFocusStart.addEventListener("focus",this.focusLastElement.bind(this)),this.modalClose.addEventListener("click",this.close.bind(this)),this.modalOverlay.addEventListener("click",this.close.bind(this))}return _createClass(Modal,[{key:"close",value:function(){var _this2=this;this.state&&(this.modal.classList.remove(this.classNameOpen,this.optionalClass),this.focusOnClose&&this.focusOnClose.focus(),setTimeout(function(){_this2.state=!1},500),Modal.hash&&history.replaceState("",document.title,window.location.pathname),this.onClose&&this.onClose())}},{key:"open",value:function(){var _this3=this;if(!this.state){this.modal.classList.add(this.optionalClass),document.body.appendChild(this.modal);var delay=this.appended?0:100;this.appended||(this.appended=!0),setTimeout(function(){_this3.modal.classList.add(_this3.classNameOpen),_this3.focusFirstElement()},delay),this.state=!0,this.onOpen&&this.onOpen();document.addEventListener("keydown",function onKeyDown(e){27==e.keyCode&&(_this3.close(),document.removeEventListener("keydown",onKeyDown.bind(_this3),!1))}.bind(this),!1)}}},{key:"focusFirstElement",value:function(){var finalElement=function findFirst(parent){return parent.firstElementChild?findFirst(parent.firstElementChild):parent}(this.modalContent.firstElementChild);finalElement.setAttribute("tabindex",-1),finalElement.focus()}},{key:"focusLastElement",value:function(){var focusableElements=this.modalContent.querySelectorAll('[href], button, [tabindex="0"]');0<focusableElements.length?focusableElements[focusableElements.length-1].focus():this.modalClose.focus()}},{key:"focusOnClose",get:function(){return this._focusOnClose},set:function(element){!element instanceof HTMLButtonElement&&!element instanceof HTMLAnchorElement&&!element.getAttribute("tabindex")||(this._focusOnClose=element)}},{key:"onOpen",get:function(){return this._onOpen},set:function(callback){callback&&"function"==typeof callback&&(this._onOpen=callback)}},{key:"onClose",get:function(){return this._onClose},set:function(callback){callback&&"function"==typeof callback&&(this._onClose=callback)}},{key:"optionalClass",set:function(className){className&&"string"==typeof className&&(this._optionalClass=className)},get:function(){return this._optionalClass||""}},{key:"closeButtonContent",set:function(content){if(content){if("string"!=typeof content)return content instanceof HTMLElement?(this.modalClose.innerHTML="",void this.modalClose.appendChild(content)):void 0;this.modalClose.innerHTML=content}}},{key:"content",set:function(content){if(content&&!("string"!=typeof content&&!content instanceof HTMLElement)){if(this.storeContent&&this.wrapperOfContent.appendChild(this._content),"string"!=typeof(this._content=content))return this.storeContent=!0,this.modalContent.innerHTML="",void this.modalContent.appendChild(this._content);this.storeContent=!1,this.modalContent.innerHTML=this._content}}}],[{key:"hash",get:function(){var URLhash=/#\!?\/(.+)\//i.exec(window.location.hash);return URLhash&&1<URLhash.length?URLhash[1]:null}}]),Modal}(),_default=Modal;exports.default=_default;